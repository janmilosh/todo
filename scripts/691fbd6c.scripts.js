"use strict";var app=angular.module("todoApp",["ngResource","ngSanitize","ngRoute","firebase"]).constant("FIREBASE_URL","https://milosh-todo.firebaseio.com/");app.config(["$routeProvider",function(a){a.when("/tasks",{templateUrl:"views/tasks.html",controller:"TasksCtrl"}).when("/",{templateUrl:"views/lists.html",controller:"ListsCtrl"}).when("/register",{templateUrl:"views/register.html",controller:"AuthCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"AuthCtrl"}).otherwise({redirectTo:"/"})}]),app.controller("TasksCtrl",["$scope","$rootScope","$timeout","$location","Task",function(a,b,c,d,e){b.$on("$firebaseSimpleLogin:login",function(c,d){b.currentUser=d,a.user=b.currentUser.id,b.signedIn=!0,a.populateTasks()}),b.$on("$firebaseSimpleLogin:logout",function(){b.signedIn=!1,delete b.currentUser,d.path("/login")}),a.now=Date.now();var f=function(){a.now=Date.now(),c(f,6e4)};f(),a.task={title:"",date:"",description:""},a.$on("$routeChangeSuccess",function(){b.signedIn?(a.user=b.currentUser.id,a.populateTasks()):console.log("Waiting for firebase login event to occur.")}),a.inputFocused=!1,a.createTask=function(){b.signedIn?(a.task.date=Date.now(),e.addTaskToUser(a.task,a.user).then(function(){a.populateTasks(),a.task={title:"",date:"",description:""}}),a.inputFocused=!0):console.log("There is no user signed in right now.")},a.populateTasks=function(){b.signedIn&&(a.tasks=e.getUserTasks(b.currentUser.id))},a.updateTaskItem=function(c,d,f){b.signedIn?e.updateTaskItem(c,d,f,a.user):console.log("There is no user signed in right now.")},a.deleteTask=function(a){if(b.signedIn){var c=b.currentUser.id;e.deleteTaskFromUser(a,c)}else console.log("There is no user signed in right now.")}}]),app.factory("Task",["$firebase","FIREBASE_URL",function(a,b){var c=new Firebase(b+"users"),d=a(c),e={addTaskToUser:function(a,b){var c=d.$child(b);return c.$child("tasks").$add(a)},getUserTasks:function(a){var b=d.$child(a);return b.$child("tasks")},deleteTaskFromUser:function(a,b){var c=d.$child(b);c.$child("tasks").$remove(a)},updateTaskItem:function(a,b,c,e){var f=d.$child(e);f.$child("tasks").$child(a).$child(b).$set(c)}};return e}]),app.controller("AuthCtrl",["$scope","$rootScope","$location","Auth","User",function(a,b,c,d,e){a.login=function(){a.error=null,d.login(a.user).then(function(){a.resetForm(),c.path("/")},function(b){a.error=b.toString()})},a.register=function(){a.error=null,d.register(a.user).then(function(b){e.create(b),a.login(a.user),a.resetForm()},function(b){a.error=b.toString()})},a.resetForm=function(){a.user={email:"",password:"",passwordConfirmation:""}}}]),app.factory("Auth",["$firebaseSimpleLogin","FIREBASE_URL","$rootScope","$location",function(a,b,c,d){var e=new Firebase(b),f=a(e);c.passwordMissmatch=!1;var g={register:function(a){return a.password===a.passwordConfirmation?(c.passwordMissmatch=!1,f.$createUser(a.email,a.password)):void(c.passwordMissmatch=!0)},login:function(a){return f.$login("password",{email:a.email,password:a.password,rememberMe:!0})},logout:function(){f.$logout(),c.signedIn=!1,delete c.currentUser,d.path("/login")}};return g}]),app.controller("NavCtrl",["$scope","$rootScope","$location","Auth",function(a,b,c,d){b.$on("$firebaseSimpleLogin:login",function(a,c){b.currentUser=c,b.signedIn=!0}),b.$on("$firebaseSimpleLogin:logout",function(){b.signedIn=!1,b.currentUser=null,c.path("/login")}),a.logout=function(){d.logout(),b.currentUser=null,c.path("/login")}}]),app.factory("User",["$firebase","FIREBASE_URL",function(a,b){var c=new Firebase(b+"users"),d=a(c),e={create:function(a){d[a.id]={email:a.email,md5_hash:a.md5_hash},d.$save()},getUserTasks:function(a){var b=e.getCurrentUser(a);return b.$child("tasks")},getCurrentUser:function(a){return d.$child(a)}};return e}]),app.factory("List",["$firebase","FIREBASE_URL",function(a,b){var c=new Firebase(b+"users"),d=a(c),e={addListToUser:function(a,b){var c=d.$child(b);return c.$child("lists").$add(a)},getUserLists:function(a){var b=d.$child(a);return b.$child("lists")},deleteListFromUser:function(a,b){var c=d.$child(b);c.$child("lists").$remove(a)},updateListItem:function(a,b,c,e){var f=d.$child(e);f.$child("lists").$child(a).$child(b).$set(c)}};return e}]),app.controller("ListsCtrl",["$scope","$rootScope","$timeout","$location","List",function(a,b,c,d,e){b.$on("$firebaseSimpleLogin:login",function(c,d){b.currentUser=d,a.user=b.currentUser.id,console.log("$scope.user in ListsCtrl: ",a.user),b.signedIn=!0,a.populateLists()}),b.$on("$firebaseSimpleLogin:logout",function(){b.signedIn=!1,delete b.currentUser,d.path("/login")}),a.now=Date.now();var f=function(){a.now=Date.now(),c(f,6e4)};f(),a.list={title:"",date:""},a.$on("$routeChangeSuccess",function(){b.signedIn?(a.user=b.currentUser.id,a.populateLists()):console.log("Waiting for firebase login event to occur.")}),a.createList=function(){b.signedIn?(a.list.date=Date.now(),console.log("$scope.list: ",a.list),console.log("$scope.user: ",a.user),e.addListToUser(a.list,a.user).then(function(){a.populateLists(),a.list={title:"",date:""}})):console.log("There is no user signed in right now.")},a.populateLists=function(){b.signedIn&&(a.lists=e.getUserLists(b.currentUser.id))},a.updateListItem=function(c,d,f){b.signedIn?e.updateListItem(c,d,f,a.user):console.log("There is no user signed in right now.")},a.deleteList=function(a){if(b.signedIn){var c=b.currentUser.id;e.deleteListFromUser(a,c)}else console.log("There is no user signed in right now.")}}]),app.directive("setFocus",["$timeout",function(a){return{link:function(b,c){c.bind("click",function(){a(function(){var a=document.getElementsByTagName("input")[0];a.focus()})})}}}]);